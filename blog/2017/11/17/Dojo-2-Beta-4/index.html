<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Dojo 2 Beta 4 | Dojo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The Beta 4 Release of Dojo 2 puts us on a clear path to releasing Dojo 2.  It has several significant changes and updates.">
<meta property="og:type" content="article">
<meta property="og:title" content="Dojo 2 Beta 4">
<meta property="og:url" content="https://dojo.github.io/blog/2017/11/17/Dojo-2-Beta-4/index.html">
<meta property="og:site_name" content="Dojo">
<meta property="og:description" content="The Beta 4 Release of Dojo 2 puts us on a clear path to releasing Dojo 2.  It has several significant changes and updates.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://dojo.github.io/blog/2017/11/17/Dojo-2-Beta-4/featured.png">
<meta property="og:image" content="https://dojo.github.io/blog/2017/11/17/Dojo-2-Beta-4/accordion.png">
<meta property="og:image" content="https://dojo.github.io/blog/2017/11/17/Dojo-2-Beta-4/tooltip.png">
<meta property="og:updated_time" content="2017-11-20T11:49:42.778Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dojo 2 Beta 4">
<meta name="twitter:description" content="The Beta 4 Release of Dojo 2 puts us on a clear path to releasing Dojo 2.  It has several significant changes and updates.">
<meta name="twitter:image" content="https://dojo.github.io/blog/2017/11/17/Dojo-2-Beta-4/featured.png">
<meta name="twitter:creator" content="@https:&#x2F;&#x2F;twitter.com&#x2F;dojo">
  
    <link rel="alternate" href="/atom.xml" title="Dojo" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicons/favicon.ico">
  
  <link rel="stylesheet" href="/css/main.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-3242977-15', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css"></head>

	<body class="body-single-page
">
		<div class="page-wrapper">
			<header class="header">
	<div class="container">
		<nav class="navbar">
			<div class="navbar-brand">
				<a href="/" class="navbar-item"><img src="/images/logos/dojo2-logo-white.svg" class="site-logo" alt="Dojo"></a>
				<div class="navbar-burger">
					<span></span>
					<span></span>
					<span></span>
				</div>
			</div>
			<div class="navbar-menu">
				<div class="navbar-start"></div>
				<div class="navbar-end">
					<a class="navbar-item" href="/docs/fundamentals/accessibility/index.html">Docs</a>
					<a class="navbar-item" href="/tutorials">Tutorials</a>
					<a class="navbar-item" href="/blog">Blog</a>
					<a class="navbar-item" href="https://github.com/dojo/meta"><span class="icon is-medium"><i class="fa fa-github" aria-hidden="true"></i></span></a>
				</div>
			</div>
		</nav>
	</div>
</header>

			<div class="content-wrapper">
				<div class="page-content">
					<div class="section">
	<div class="container article">
		<article id="post-Dojo-2-Beta-4" class="article article-type-post" itemscope itemprop="blogPost">
			<div class="article-inner">
				
				
					<header class="article-header">
						<div class="article-meta">
							<div class="author-meta">
	
	<span class="author-name"> Kitson Kelly</span>
	<span class="article-date">
  <time datetime="2017-11-17T18:00:00.000Z" itemprop="datePublished">November 17th 2017, 6:00 pm</time>
</span>
</div>
							
						</div>
						
  
    <h1 class="article-title" itemprop="name">
      Dojo 2 Beta 4
    </h1>
  

					</header>
				
				<div class="article-entry" itemprop="articleBody">
					
						<p>The Beta 4 Release of Dojo 2 puts us on a clear path to releasing Dojo 2.  It has several significant changes and updates.</p>
<img src="/blog/2017/11/17/Dojo-2-Beta-4/featured.png" title="feature-full">
<a id="more"></a>
<h2 id="Getting-Beta-4"><a href="#Getting-Beta-4" class="headerlink" title="Getting Beta 4"></a>Getting Beta 4</h2><p>Beta 4 is currently tagged as <code>latest</code> in npm, so all just updating to the latest version will provide you with Beta 4.  We also have a release tag of <code>beta4</code> in npm if you want to focus just on using Beta 4.</p>
<p>With Beta 3, we revised our package versions to make it easier to keep a compatible set of packes.  We are releasing all the pre-release versions of Dojo 2 packages under major version <code>0</code>, but are introducing breaking changes in the minor release (e.g. <code>0.2.0</code> has breaking changes from <code>0.1.0</code>).  The versions we publish to npm rely upon a minor range.  You will see that some packages for Beta 4 are <code>0.3.#</code> and some are <code>0.2.#</code>, but they all depend on a range of version they know they are compatible with.  This means you don’t have to rely upon a release tag.  So ideally you would want to ensure if you are managing your dependencies directly, you depend upon a minor release (e.g. <code>~0.2.0</code>) for packages.</p>
<p>As we make releases of packages in anticipation of Beta 5, we will not publish those packages to <code>latest</code> until we release Beta 5.</p>
<h2 id="Integrated-virtual-DOM"><a href="#Integrated-virtual-DOM" class="headerlink" title="Integrated virtual DOM"></a>Integrated virtual DOM</h2><p>This was the biggest fundamental change for the Beta 4 release.  Instead of depending on the <a href="https://maquettejs.org/" target="_blank" rel="noopener">Maquette</a> virtual DOM library, we realised that our specialised requirements and needs were better solved in the medium and long term by integrating it directly.  So in Beta 4 we have replace Maquette with <code>@dojo/widget-core/vdom</code>.</p>
<p>This has allowed us to directly merge our abstraction of widgets and virtual DOM nodes with the virtual DOM nodes that get rendered to the DOM.  This increases the performance of the widgeting system, but also allowed us to make other performance and memory improvements to the widgeting system.</p>
<p>This alone would not have had an effect on users of Dojo 2, but it allowed us to address a whole list of features we desired and refactoring of code that introduced some significant <strong>breaking changes</strong> in Beta 4.</p>
<h2 id="Virtual-DOM-classes"><a href="#Virtual-DOM-classes" class="headerlink" title="Virtual DOM classes"></a>Virtual DOM classes</h2><p>We felt that one of the biggest usability issues we had with Dojo 2 had to do with dealing with classes.  In Beta 4, we have changed this significantly, and while it is a <strong>breaking change</strong> we think the end result is <em>a lot</em> more usable.</p>
<p>Previously, <code>classes</code> were actually an object map of keys with a boolean value.  If you were using the theming system, you would use a function to specify your classes in a more functional way, which would generate a memoised map for you.  If you weren’t you would have to do this yourself.  While it might be ok to author, it was really difficult to test.  It would look something like this:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/d'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WidgetBase <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/WidgetBase'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ThemeableMixin<span class="token punctuation">,</span> <span class="token punctuation">{</span> theme <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/mixins/Themeable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> as css <span class="token keyword">from</span> <span class="token string">'./styles/mywidget.m.css'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ThemeableBase <span class="token operator">=</span> <span class="token function">ThemeableMixin</span><span class="token punctuation">(</span>WidgetBase<span class="token punctuation">)</span><span class="token punctuation">;</span>

@<span class="token function">theme</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyWidget</span> <span class="token keyword">extends</span> <span class="token class-name">ThemeableBase</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            classes<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">classes</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fixed</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>rootFixed<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'Hello world!'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>With the changes in Beta 4, this gets written as:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/d'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WidgetBase <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/WidgetBase'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ThemedMixin<span class="token punctuation">,</span> <span class="token punctuation">{</span> theme <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/mixins/Themed'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> as css <span class="token keyword">from</span> <span class="token string">'./styles/mywidget.m.css'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ThemedBase <span class="token operator">=</span> <span class="token function">ThemedMixin</span><span class="token punctuation">(</span>WidgetBase<span class="token punctuation">)</span><span class="token punctuation">;</span>

@<span class="token function">theme</span><span class="token punctuation">(</span>css<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyWidget</span> <span class="token keyword">extends</span> <span class="token class-name">ThemedBase</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            classes<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">theme</span><span class="token punctuation">(</span>css<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">,</span> css<span class="token punctuation">.</span>rootFixed <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'Hello world!'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>classes</code> property is now just an array of strings.  Also we think that the mixed in method <code>theme()</code> is a lot more clear on what you are doing instead of <code>classes()</code>.  <em>Fixed</em> classes are just simply added to the array, instead of being supplied to a chained function.</p>
<p>This also means that the <code>@dojo/test-extras/harness</code> has been updated to remove the memoised class functionality, making tests far easier to author, not having to worry about replicating the order of adding classes to an expected widget render.  Also, we renamed <code>Themeable</code> to <code>Themed</code> as we felt it was better semantics for our mixins.</p>
<h2 id="Widget-lifecycle-changes"><a href="#Widget-lifecycle-changes" class="headerlink" title="Widget lifecycle changes"></a>Widget lifecycle changes</h2><p>We were never completely happy with the APIs we provided for end users to interact with the widget lifecycle.  We have long felt that one of the biggest challenges with Dojo 1 Dijits was a complicated lifecycle.  In general the Dojo 2 widgeting system takes care of everything and developers really shouldn’t need to worry about the lifecycle and instead just worry about rendering when requested.  There are still use cases where a developer does need to know when the virtual DOM they render is added to or removed from the DOM.</p>
<p>In Beta 4 we have introduced two lifecycle methods to <code>WidgetBase</code>.  They are called <code>onAttach</code> and <code>onDetach</code>.  They are designed to allow a widget developer to <em>hook</em> when a widget instance is attached to the DOM or detached from the DOM.</p>
<p>To use them, it simply requires overriding the <code>onAttach</code> or <code>onDetach</code> methods.  For example:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/d'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WidgetBase <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/WidgetBase'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyWidget</span> <span class="token keyword">extends</span> <span class="token class-name">WidgetBase</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token function">onAttach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// perform actions when attached</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token function">onDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// perform actions when detached</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'Hello world!'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Previously, we had other capabilities which provided functionality in this area, but we have deprecated those and will remove them in the future.</p>
<h2 id="Deferred-properties"><a href="#Deferred-properties" class="headerlink" title="Deferred properties"></a>Deferred properties</h2><p>A virtual DOM node can now provide its properties in a way that are resolved in a deferred fashion, where instead of providing an object of <code>VirtualDomProperties</code>, you can provide a function which takes a boolean flag of if the virtual DOM node has been insterted into the DOM and returns an object of <code>VirtualDomProperties</code>.</p>
<p>Because these functions will be called during the next <code>requestAnimationFrame</code> (when the projector is running in its default asynchronous mode), this feature can be used to better handle CSS transistion states.  For example, you can now do something like this:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/d'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WidgetBase <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/WidgetBase'</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            classes<span class="token punctuation">:</span> <span class="token string">'fadeInTransition'</span><span class="token punctuation">,</span>
            styles<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                opacity<span class="token punctuation">:</span> inserted <span class="token operator">?</span> <span class="token string">'1'</span> <span class="token punctuation">:</span> <span class="token string">'0'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'Hello World!'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Web-animations-meta-provider"><a href="#Web-animations-meta-provider" class="headerlink" title="Web animations meta provider"></a>Web animations meta provider</h2><p>One of the goals of the Dojo 2 widgeting system is to provide sufficient tools and abstractions so that widget authors don’t have to deal directly with the DOM.  Meta providers provide ways to interact with the DOM, sometimes in complex ways, without having to sweat the details.</p>
<p>In this vein, we have added a web animations meta provider in Beta 4.  It provides a way to easily animate DOM nodes in a reactive way, as just part of your render.  For example:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> v <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/d'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WidgetBase <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/WidgetBase'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WebAnimation <span class="token keyword">from</span> <span class="token string">'@dojo/widget-core/meta/WebAnimation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">AnimatedWidget</span> <span class="token keyword">extends</span> <span class="token class-name">WidgetBase</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> animate <span class="token operator">=</span> <span class="token punctuation">{</span>
            id<span class="token punctuation">:</span> <span class="token string">'rootAnimation'</span><span class="token punctuation">,</span>
            effects<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> height<span class="token punctuation">:</span> <span class="token string">'10px'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> height<span class="token punctuation">:</span> <span class="token string">'100px'</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            controls<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                play<span class="token punctuation">:</span> <span class="token keyword">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">meta</span><span class="token punctuation">(</span>WebAnimation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">,</span> animate<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">v</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            key<span class="token punctuation">:</span> <span class="token string">'root'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Custom-Elements-Web-Components"><a href="#Custom-Elements-Web-Components" class="headerlink" title="Custom Elements/Web Components"></a>Custom Elements/Web Components</h2><p>One of the main objectives for Dojo 2 was that there was a high level of interoperability with Web Components, both using Web Components in Dojo 2 applications but also being able to use Dojo 2 widgets easily as Custom Elements.  We made several changes to the widgeting system to better support Dojo 2 widgets used as Custom Elements, specifically making it efficient to use children Custom Elements of a Dojo 2 widget Custom Element.</p>
<p>So what you would write in TypeScript:</p>
<pre class=" language-typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token keyword">extends</span> <span class="token class-name">WidgetBase</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token function">_onSelected</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">protected</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">w</span><span class="token punctuation">(</span>Menu<span class="token punctuation">,</span> <span class="token punctuation">{</span> onSelected<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onSelected <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">w</span><span class="token punctuation">(</span>MenuItem<span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'Menu Item A'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">w</span><span class="token punctuation">(</span>MenuItem<span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'Menu Item B'</span><span class="token punctuation">,</span> selected<span class="token punctuation">:</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">w</span><span class="token punctuation">(</span>MenuItem<span class="token punctuation">,</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span> title<span class="token punctuation">:</span> <span class="token string">'Menu Item C'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Can be written as this using when using Custom Elements:</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo-menu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo-menu-item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Menu Item A<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo-menu-item</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo-menu-item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Menu Item B<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo-menu-item</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>demo-menu-item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Menu Item C<span class="token punctuation">"</span></span> <span class="token attr-name">selected</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo-menu-item</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>demo-menu</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>
  a.data = { foo: 'bar' };
  menu.addEventListener('selected', function(event) {
    const detail = event.detail;
    console.log(detail);
  });
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
<p>We have an <a href="https://dojo.github.io/examples/custom-element-menu/">live example</a> of this, along with the <a href="https://github.com/dojo/examples/tree/master/custom-element-menu" target="_blank" rel="noopener">source code on GitHub</a>.</p>
<h2 id="Other-widget-system-improvements"><a href="#Other-widget-system-improvements" class="headerlink" title="Other widget system improvements"></a>Other widget system improvements</h2><p>There were other changes to the widgeting system which enable some features and capabilities we think can make widgets more robust:</p>
<ul>
<li>The way event listeners behave on virtual DOM nodes has changed, and we now allow the listeners to change between renders.  Previously this would have errored.</li>
<li>There is a lot more flexibility about what the <em>root</em> of a <code>Projector</code> can be, which includes being able to return a widget node, or an array of nodes.  Also, previously there were challenges with changing the root of the projector after the first render, which is now allowed.</li>
<li>Several internal performance and memory improvements to the virtual DOM and widgeting system.</li>
</ul>
<h2 id="New-widgets"><a href="#New-widgets" class="headerlink" title="New widgets"></a>New widgets</h2><p>We have introduced two new widgets in Beta 4 and are considering more before the release of Dojo 2.  Really we want to focus on trying to hone our patterns for widgets to provide examples for others to build widgets, but do know that especially for rapid prototyping it is helpful to have <em>out-of-the-box</em> widgets.</p>
<p>We have introduced a new accordion pane widget (<code>@dojo/widgets/accordionpane/AccordionPane</code>):</p>
<p><img src="./accordion.png" alt="The accordion pane widget" height="465" width="351"></p>
<p>As well as we have introduced a tooltip widget (<code>@dojo/widgets/tooltip/Tooltip</code>):</p>
<p><img src="./tooltip.png" alt="The tooltip widget" height="104" width="415"></p>
<h2 id="Other-widget-improvements"><a href="#Other-widget-improvements" class="headerlink" title="Other widget improvements"></a>Other widget improvements</h2><p>We have also been trying to standardise our conventions in widgets in Beta 4, though we will likely have more changes for Beta 5.  In particular we have been rationalising our styles, making sure that themeable styles and the structural styles are clearly delineated, making it easier to theme existing widgets.  We have also been looking at the ways to better customise and extend the out of the box widgets.</p>
<h2 id="Stores-re-architecture"><a href="#Stores-re-architecture" class="headerlink" title="Stores re-architecture"></a>Stores re-architecture</h2><p>The current API in Dojo 1 for managing state focused on a CRUD type API.  Originally in Dojo 2 we directly adapted that API as part of <em>stores</em>.  Recently though, the concept of state containers has taken front and centre and we knew we wanted to create a solution that aligned to that architecture.</p>
<p>Instead of CRUD type API, it focuses on three main concepts:</p>
<ul>
<li><em>Operation</em> which is a granular state mutation based on the JSON Patch API</li>
<li><em>Command</em> a semantically aligned function which returns a set of operations to apply</li>
<li><em>Process</em> a function that groups commands into a <em>process flow</em> to represent a complete behaviour</li>
</ul>
<p>You can read more about the new API at <a href="https://github.com/dojo/stores" target="_blank" rel="noopener"><code>dojo/stores</code></a>.</p>
<h2 id="A-new-approach-to-shims-and-polyfills"><a href="#A-new-approach-to-shims-and-polyfills" class="headerlink" title="A new approach to shims and polyfills"></a>A new approach to shims and polyfills</h2><p>We have rationalised the way we introduce compatibility across environments as well as improvements to the build system to optimize these when building an application.  We realised that some packages were wanting to depend upon 3rd party polyfills but we did not have a consistent way to introduce them as well as elide them if not needed.</p>
<p>Now <code>@dojo/shim/main</code> loads all the polyfills needed to provide the expected base functionality and <code>@dojo/shim/browser</code> will load polyfills for a browser environment.  Most end developers will not need to worry about this as the other Dojo 2 packages will ensure that these modules get loaded.</p>
<p>Of course if you are building an application that is targetting only certain platforms, these polyfills will simply result in a non-operation, but will still be part of the bundle.  We have added an additional static build optimisation feature, where a specially formed pragma will denote the feature that the next import will be polyfilling, and if that feature is not required based on the build targets, it will be removed from the build.  More information can be found in the <a href="https://github.com/dojo/webpack-contrib#elided-imports" target="_blank" rel="noopener">documentation for the feature</a>.</p>
<h2 id="Iterators"><a href="#Iterators" class="headerlink" title="Iterators"></a>Iterators</h2><p>Previously we had provided a functional replacement for <code>for...of</code> constructs so that developers could author code that worked in older browsers as well as we provided shims for <code>Symbol</code> and the built in ES6 iterators.  In TypeScript 2.3 though, a down level emit for iterators was introduced.  We have restructured our packages to use <code>for...of</code> instead of the <code>@dojo/shim/iterator.forOf()</code> function and will likely remove <code>forOf()</code> in the future.  We recommend users of Dojo 2 also migrate to this syntax.</p>
<h2 id="TypeScript-helpers"><a href="#TypeScript-helpers" class="headerlink" title="TypeScript helpers"></a>TypeScript helpers</h2><p>When emitting to JavaScript from TypeScript, all of our run-time modules included any of the TypeScript helpers.  This causes the bundle size to increase because these helpers would be written out multiple times.  In Beta 4, we have changed to import our helpers from <code>tslib</code> and automatically include these helpers once as part of the CLI build tool.</p>
<h2 id="What-is-next"><a href="#What-is-next" class="headerlink" title="What is next"></a>What is next</h2><p>We are planning quite a few things for Beta 5, which will always chop and change a little bit, but what to look forward to:</p>
<ul>
<li>A re-architected build tool, which will include build time rendering to automatically identify critical path resources in the build to provide automatic code splitting and build optimisation.</li>
<li>More performance improvements for the widgeting system.</li>
<li>More examples and applications of <code>@dojo/stores</code> based on the new architecture.</li>
<li>Improvements to the tooling around widget themes</li>
</ul>

					
				</div>
				<footer class="article-footer">
					
					
				</footer>
			</div>
			
				
<nav id="article-nav">
  
  
    <a href="/blog/2017/03/27/Dojo-2-is-coming/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Dojo 2 is coming</div>
    </a>
  
</nav>

			
		</article>

		
	</div>
</div>

				</div>
				<footer class="footer">
  <div class="container">
    <div class="info">
      <span class="is-size-7">&copy; JS Foundation, All Rights Reserved.</span>
    </div>
  </div>
</footer>

			</div>
			
		</div>
		
<!-- build:js /js/combined.js -->
<script src='/js/site.js'></script>
<!-- endbuild -->
	</body>
</html>
